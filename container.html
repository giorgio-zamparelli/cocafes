<!DOCTYPE html>
<html>
<head>

    <style>

        body, html {

            height: 100%;
            width: 100%;
            margin: 0;

        }




    </style>

</head>
<body>

    <div id="spinner" style="background-color:#dce1e3;position: fixed;height:100%;width:100%;display: flex;align-items: center;justify-content: center;">
        <img src="spinner.gif" style="width:40px;height:40px;"/>
    </div>

    <webview nodeintegration allowpopups></webview>

    <script>

        window.addEventListener('load', function() {

            var webview = document.getElementsByTagName("webview")[0];

            var url = "https://cocafes.herokuapp.com/electron/";

            if (typeof(require) !== 'undefined') {

                const environment = require('electron').remote.getGlobal("environment");

                if ("development" === environment) {

                    url = "http://localhost/electron/";

                }

            }

            console.log("webview src=\"" + url + "\"");
            webview.setAttribute("src", url);

            webview.addEventListener("did-stop-loading", function() {

                document.getElementById("spinner").style.visibility = 'hidden';

            });

            webview.addEventListener('console-message', function(e) {

                console.log('Guest page logged a message:', e.message);

            });

            // if ("development" === require('electron').remote.getGlobal("environment")) {
            //
            //     webview.addEventListener("dom-ready", function() {
            //         webview.openDevTools({detach:true});
            //     });
            //
            // }

            document.addEventListener("visibilitychange", function() {

                if (document.visibilityState === "visible") {

                    webview.reload();

                }

            });

            window.addEventListener('online',  function (event) {

                webview.reload();

            });

            //show DEV TOOLS with shortcut CMD + OPTION + I

            var map = {18: false, 91: false, 73: false};
            document.addEventListener('keydown', function(e) {

                if (e.keyCode in map) {
                    map[e.keyCode] = true;
                    if (map[18] && map[91] && map[73]) {

                        webview.openDevTools();

                        map[18] = false;
                        map[91] = false;
                        map[73] = false;

                    }
                }

            }, false)

            document.addEventListener('keyup', function(e) {

                if (e.keyCode in map) {
                    map[e.keyCode] = false;
                }

            }, false);



        });

    </script>

</body>
</html>
